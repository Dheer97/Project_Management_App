<!-- project_flow/project_detail.html -->
{% extends 'project_flow_base.html' %}
{% block title %}
{{project.title}}- Project Details
{% endblock %}


{% block content %}

<div class="mb-3 d-flex justify-content-between align-items-center">
  <h1>{{project.title}}</h1>
  <div>
    <a href="{% url 'project_update' project.pk %}" class="btn btn-primary">Edit</a>
    <a href="{% url 'project_delete' project.pk %}" class="btn btn-danger">Delete</a>
    <a href="{% url 'dashboard'  %}" class="btn btn-secondary">Back to Projects</a>
  </div>
</div>

<div class="card mb-4">
  <div class="card-body">
    <h5 class="card-title">Description</h5>
    <p class="card-text">{{project.description}}</p>

    <ul class="list-group list-group-flush">
      <li class="list-group-item"><strong>Start Date:</strong>{{project.start_date}}</li>
      <li class="list-group-item"><strong>End Date:</strong>{{project.end_date}}</li>
      <li class="list-group-item"><strong>Status:</strong>{{project.get_status_display}}</li>
      <li class="list-group-item"><strong>Priority:</strong>{{project.get_priority_display}}</li>
      <li class="list-group-item"><strong>Members:</strong>
        {% if members_usernames %}
        {{members_usernames|join:","}}
        {% else %}
        <span class="text-muted">No members assigned</span>
        {% endif %}

      </li>
    </ul>
  </div>
</div>

<div class="mb-3 d-flex justify-content-between align-items-center">
  <h1>Tasks</h1>
  <a href="{% url 'task_create' project.pk %}" class="btn btn-success">Add Task</a>
</div>


{% if project.tasks.all %}
<table class="table table-striped">
  <thead>
    <tr>
      <th>Title</th>
      <th>Status</th>
      <th>Priority</th>
      <th>Due Date</th>
      <th>Assigned To</th>
      <th>Actions</th>
    </tr>
  </thead>

  <tbody>
    {% for task in project.tasks.all %}
    <tr>
      <td><a href="{% url 'task_detail' task.pk %}">{{ task.title}}</a></td>
      <td>{{task.get_status_display}}</td>
      <td>{{task.get_priority_display}}</td>
      <td>{{task.due_date}}</td>
      <td>
        {% if task.assigned_to %}
        {{task.assigned_to.username}}
        {% else %}
        Unassigned
        {% endif %}
      </td>
      <td>
        <a href="{% url 'task_update' task.pk %}" class="btn btn-sm btn-primary">Edit</a>
        <a href="{% url 'task_delete' task.pk %}" class="btn btn-sm btn-danger">Delete</a>
      </td>

    </tr>
    {% endfor %}
  </tbody>
</table>
{% else %}
<p class="text-muted">No tasks for this project</p>
{% endif %}

{% endblock %}